<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²°ì œ ê²Œì´íŠ¸ì›¨ì´ í…ŒìŠ¤íŠ¸ íŒ¨ë„</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0; padding: 0; background-color: #f4f7f6;
        }
        .container {
            max-width: 900px; margin: 20px auto; padding: 20px;
            background-color: #fff; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        h1, h2 { border-bottom: 2px solid #eee; padding-bottom: 10px; }
        h1 { text-align: center; }
        h2 { margin-top: 30px; }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }
        button {
            padding: 15px 12px; /* [ìˆ˜ì •] ìœ„ì•„ë˜ íŒ¨ë”© ì¶”ê°€ */
            font-size: 16px; font-weight: bold;
            border: none; border-radius: 6px; cursor: pointer;
            background-color: #007bff; color: white; transition: background-color 0.2s;
            line-height: 1.4; /* [ì‹ ê·œ] ì¤„ ê°„ê²© */
        }
        button:hover { background-color: #0056b3; }
        button.success { background-color: #28a745; }
        button.success:hover { background-color: #1e7e34; }
        button.fail { background-color: #dc3545; }
        button.fail:hover { background-color: #a71d2a; }
        button.secondary { background-color: #6c757d; }
        button.secondary:hover { background-color: #545b62; }

        /* [ì‹ ê·œ] ë²„íŠ¼ ë‚´ ìˆ˜ìˆ˜ë£Œ ì •ë³´ ìŠ¤íƒ€ì¼ */
        .fee-info {
            display: block;
            font-size: 13px;
            font-weight: normal;
            margin-top: 5px;
            opacity: 0.9;
        }

        /* [ì‹ ê·œ] ìš”êµ¬ì‚¬í•­ ì„¤ëª… ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        .explanation-box {
            background-color: #fdfdea;
            border: 1px solid #f0e0a0;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            font-size: 14px;
        }
        .explanation-box ul {
            margin: 10px 0 0 20px;
            padding: 0;
        }
        .explanation-box li { margin-bottom: 5px; }

        .input-group { margin-bottom: 15px; }
        label { font-weight: bold; margin-right: 10px; }
        input[type="text"], input[type="number"] {
            width: 300px; padding: 8px; font-size: 14px;
            border: 1px solid #ccc; border-radius: 4px;
        }

        .config-grid {
            display: grid;
            grid-template-columns: 120px 1fr 1fr 1fr;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
        }
        .config-grid > button { font-size: 14px; padding: 10px; }

        #response-container { margin-top: 20px; }
        pre {
            background-color: #2d333b; color: #adbac7;
            padding: 15px; border-radius: 6px; overflow-x: auto;
            min-height: 150px;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸš€ ê²°ì œ ê²Œì´íŠ¸ì›¨ì´ í…ŒìŠ¤íŠ¸ íŒ¨ë„</h1>

    <h2>1. ê²°ì œ ìš”ì²­ (POST /request)</h2>

    <div class="explanation-box">
        <b>ğŸ’¡ ë¼ìš°íŒ… ê·œì¹™ (pg-policy.yml)</b>
        <ul>
            <li><b>ìˆ˜ìˆ˜ë£Œ ìµœì €:</b> ê²°ì œ ìˆ˜ìˆ˜ë£Œê°€ ê°€ì¥ ì €ë ´í•œ PGì‚¬ë¥¼ 1ìˆœìœ„ë¡œ ì„ íƒí•©ë‹ˆë‹¤.</li>
            <li><b>ê¸°ëŠ¥ í™•ë³´:</b> ê²°ì œ ìˆ˜ë‹¨ì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” PGì‚¬ëŠ” ì œì™¸ë©ë‹ˆë‹¤.</li>
            <li><b>ëœë¤ ì •ë ¬:</b> ìˆ˜ìˆ˜ë£Œê°€ ë™ì¼í•œ PGì‚¬ëŠ” ëœë¤ìœ¼ë¡œ ìˆœì„œê°€ ê²°ì •ë©ë‹ˆë‹¤.</li>
        </ul>
    </div>

    <div class="input-group">
        <label for="amount">ê¸ˆì•¡:</label>
        <input type="number" id="amount" value="10000">
    </div>
    <div class="input-group">
        <label for="productName">ìƒí’ˆëª…:</label>
        <input type="text" id="productName" value="í† ì´ í”„ë¡œì íŠ¸ í…ŒìŠ¤íŠ¸ ìƒí’ˆ">
    </div>

    <div class="grid">
        <button onclick="requestPayment('CREDIT_CARD')">
            ğŸ’³ ì‹ ìš©ì¹´ë“œ
            <span class="fee-info">
                    (1) nicepay: 2%<br>
                    (2) inicis: 3%<br>
                    (3) toss: 5%
                </span>
        </button>
        <button onclick="requestPayment('BANK_TRANSFER')">
            ğŸ¦ ê³„ì¢Œì´ì²´
            <span class="fee-info">
                    (1) nicepay: 7%<br>
                    (2) toss: 10%<br>
                    (3) inicis: 12%
                </span>
        </button>
        <button onclick="requestPayment('NAVER_PAY')">
            ğŸ‡³ ë„¤ì´ë²„í˜ì´
            <span class="fee-info">
                    (1) toss: 15% (ëœë¤)<br>
                    (1) inicis: 15% (ëœë¤)<br>
                    (nicepay: ë¯¸ì§€ì›)
                </span>
        </button>
    </div>

    <h2>2. âš ï¸ Failover & ì„œí‚· í…ŒìŠ¤íŠ¸ (POST /test/config)</h2>
    <p>ê° PGì‚¬ì˜ ì¥ì•  ìƒíƒœë¥¼ DBì— ì„¤ì •í•©ë‹ˆë‹¤. (DB ê°’ì´ ì–´ëŒ‘í„°ì— ë°˜ì˜ë˜ì–´ì•¼ í•¨)</p>

    <div class="config-grid">
        <strong>Nicepay (1ìˆœìœ„)</strong>
        <button class="success" onclick="setFailureConfig('nicepay', false, false)">Nicepay ì •ìƒ</button>
        <button class="fail" onclick="setFailureConfig('nicepay', true, false)">Nicepay 5xx ê°•ì œ</button>
        <button class="fail" onclick="setFailureConfig('nicepay', false, true)">Nicepay Timeout ê°•ì œ</button>
    </div>
    <div class="config-grid">
        <strong>Inicis (2/1ìˆœìœ„)</strong>
        <button class="success" onclick="setFailureConfig('inicis', false, false)">Inicis ì •ìƒ</button>
        <button class="fail" onclick="setFailureConfig('inicis', true, false)">Inicis 5xx ê°•ì œ</button>
        <button class="fail" onclick="setFailureConfig('inicis', false, true)">Inicis Timeout ê°•ì œ</button>
    </div>
    <div class="config-grid">
        <strong>Toss (3/1ìˆœìœ„)</strong>
        <button class="success" onclick="setFailureConfig('toss', false, false)">Toss ì •ìƒ</button>
        <button class="fail" onclick="setFailureConfig('toss', true, false)">Toss 5xx ê°•ì œ</button>
        <button class="fail" onclick="setFailureConfig('toss', false, true)">Toss Timeout ê°•ì œ</button>
    </div>

    <h2 style="display: flex; justify-content: space-between; align-items: center;">
        3. ì„œë²„ ì‘ë‹µ
        <button class="secondary" onclick="clearLog()">ë¡œê·¸ ì§€ìš°ê¸°</button>
    </h2>
    <div id="response-container">
        <pre id="responseOutput">API ì‘ë‹µì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</pre>
    </div>
</div>

<script>
    const API_BASE_URL = "http://localhost:8080"; // ì„œë²„ ì£¼ì†Œ
    const responseOutput = document.getElementById('responseOutput');

    // ê³µí†µ fetch í•¨ìˆ˜
    async function apiCall(url, method, body) {
        logToScreen(`Sending ${method} to ${url}...`, body);
        try {
            const response = await fetch(url, {
                method: method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(body)
            });

            const responseText = await response.text();
            let responseData;
            try {
                responseData = JSON.parse(responseText);
            } catch (e) {
                responseData = responseText;
            }

            logToScreen(`Response from ${url} (Status: ${response.status})`, responseData);

        } catch (error) {
            logToScreen(`Error calling ${url}`, error.message);
        }
    }

    // 1. ê²°ì œ ìš”ì²­ í•¨ìˆ˜ (ì˜¤íƒ€ ìˆ˜ì •ë¨)
    function requestPayment(paymentMethod) {
        const amount = document.getElementById('amount').value;
        const productName = document.getElementById('productName').value; // .V -> .value

        const body = {
            amount: parseInt(amount, 10),
            productName: productName,
            paymentMethod: paymentMethod
        };

        apiCall(API_BASE_URL + '/request', 'POST', body);
    }

    // 2. ì¥ì•  ì£¼ì… API í˜¸ì¶œ í•¨ìˆ˜
    function setFailureConfig(pgName, isSystemFailure, isTimeout) {
        const body = {
            pgName: pgName,
            isSystemFailure: isSystemFailure,
            isTimeout: isTimeout
        };
        apiCall(API_BASE_URL + '/test/config', 'POST', body);
    }

    // 3. ê²°ê³¼ ì¶œë ¥ ë° ë¡œê·¸ ì§€ìš°ê¸°
    function logToScreen(title, data) {
        responseOutput.innerHTML = `<strong>${title}</strong>\n\n`;
        responseOutput.innerHTML += (typeof data === 'object') ? JSON.stringify(data, null, 2) : data;
    }

    function clearLog() {
        responseOutput.innerHTML = "API ì‘ë‹µì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.";
    }
</script>

</body>
</html>